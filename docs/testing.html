<!DOCTYPE html>
<html>
  <head>
    <title>GIN.IO | Testing</title>
      <meta http-equiv="content-type" content="text/html; charset=UTF-8" \>
      <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400' rel='stylesheet' type='text/css'>
      <link href='http://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'>

      <link rel="stylesheet" href="../assets/application-6f2e77e84ad9065a0feadc82b880cd42.css">
      <script src="../assets/application-2079ecccecce249e09f2a3ae08342e79.js"></script>
  </head>

  <body>
    <div id="header">
      <div class="container">
        <div class="title">
          <a href="../">GIN.IO</a>
        </div>

        <div class="top-nav">
          <ul>
            <li><a href="../">Home</a></li>
            <li><a href="../docs/install.html">Docs</a></li>
            <li><a href="../tutorial.html">Tutorial</a></li>
            <li><a href="https://github.com/ostinelli/gin">Source</a></li>
          </ul>
        </div>
      </div>
    </div>


<div class="wrapper">
  <div class="container">

    <div class="main">
      <h1>Testing</h1>

<p>Testing is supported out of the box in Gin. The main testing framework is <a href="http://olivinelabs.com/busted/">Busted</a>, which has an <a href="http://rspec.info/">RSpec</a>-like syntax. If you ever used <a href="http://pivotal.github.io/jasmine/">Jasmine</a> you&#39;ll feel right at home.</p>

<p>In addition, Gin provides test helpers for you to use.</p>

<h4>Controllers</h4>

<p>Controller Tests in Gin are actually integration tests. An instance of OpenResty nginx will be started and a real request will be issued to a test server.</p>

<p>The main Gin test helper you&#39;ll need to use is the function <code>hit</code>, that will perform the integration test for you.</p>

<p>Here&#39;s an example of a controller test (file located in <code>./spec/controllers/1/info_controller_spec.lua</code>):</p>
<div class="highlight"><pre><code class="lua language-lua" data-lang="lua"><span class="nb">require</span> <span class="s1">&#39;</span><span class="s">spec.spec_helper&#39;</span>

<span class="n">describe</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">InfoController&quot;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span>
    <span class="n">describe</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">#whoami&quot;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span>
        <span class="n">it</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">responds with whoami name&quot;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span>
            <span class="kd">local</span> <span class="n">response</span> <span class="o">=</span> <span class="n">hit</span><span class="p">({</span>
                <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GET&#39;</span><span class="p">,</span>
                <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/whoami&quot;</span>
            <span class="p">})</span>

            <span class="n">assert</span><span class="p">.</span><span class="n">are</span><span class="p">.</span><span class="n">same</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="n">response</span><span class="p">.</span><span class="n">status</span><span class="p">)</span>
            <span class="n">assert</span><span class="p">.</span><span class="n">are</span><span class="p">.</span><span class="n">same</span><span class="p">({</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">gin&quot;</span> <span class="p">},</span> <span class="n">response</span><span class="p">.</span><span class="n">body</span><span class="p">)</span>
        <span class="k">end</span><span class="p">)</span>
    <span class="k">end</span><span class="p">)</span>
<span class="k">end</span><span class="p">)</span>
</code></pre></div>
<h6>The request</h6>

<p>The <code>hit</code> helper takes a list of options:</p>

<ul>
<li><code>method</code> (required): the HTTP method (<code>GET</code>, <code>POST</code>, <code>HEAD</code>, <code>OPTIONS</code>, <code>PUT</code>, <code>PATCH</code>, <code>DELETE</code>, <code>TRACE</code>, <code>CONNECT</code>)</li>
<li><code>path</code> (required): the relative path</li>
<li><code>body</code> (optional): the request body (a Lua <code>table</code>). Defaults to <code>nil</code>.</li>
<li><code>headers</code> (optional): the request headers (a Lua <code>table</code>). Defaults to <code>{}</code>.</li>
<li><code>api_version</code> (optional): if you need to specify a minor version of the APIs, you can pass in the complete version value here (for instance, <code>1.0.2-rc1</code>). Defaults to the controller test namespace.</li>
</ul>

<h6>The response</h6>

<p>The <code>hit</code> helper returns a response object, that has the following attributes:</p>

<ul>
<li><code>status</code>: the response status (a numeric value)</li>
<li><code>headers</code>: the response headers (a Lua <code>table</code>).</li>
<li><code>body</code>: the response body (a Lua <code>table</code>).</li>
<li><code>body_raw</code>: the unparsed response body (a <code>string</code>).</li>
</ul>

<h4>Models</h4>

<p>There aren&#39;t specific Gin test helpers for models. Please refer to the <a href="../tutorial.html">tutorial</a> for examples on how to test your models.</p>

<h4>Test database fixtures</h4>

<p>It is also possible to populate the test database with the SQL ORM. Please refer to the <a href="../tutorial.html">tutorial</a> for examples on how to do it.</p>

    </div>

    <div class="sidebar docs">
      <h4>Docs</h4>

<ul>
    <li><a href="../docs/install.html">Install</a></li>
    <li><a href="../docs/getting_started.html">Getting Started</a></li>
    <li><a href="../docs/api_console.html">API Console</a></li>
    <li><a href="../docs/application_files.html">Application Files</a></li>
    <li><a href="../docs/api_versioning.html">API Versioning</a></li>
    <li><a href="../docs/routes.html">Routes</a></li>
    <li><a href="../docs/errors.html">Errors</a></li>
    <li><a href="../docs/controllers.html">Controllers</a></li>
    <li><a href="../docs/models.html">Models</a></li>
    <li><a href="../docs/migrations.html">Migrations</a></li>
    <li class="active"><a href="../docs/testing.html">Testing</a></li>
    <li><a href="../docs/other.html">Other</a></li>
</ul>

    </div>
  </div>
</div>

    </div>

    <div id="footer-top">
      <div class="container">
      </div>
    </div>

    <div id="footer-bottom">
      <div class="container">
        All rights reserved &copy; 2013
      </div>
    </div>
  </body>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45805640-1', 'gin.io');
  ga('send', 'pageview');

</script>

</html>

