#!/usr/bin/env lua

require 'zebra.core.zebra'

local help_description = [[

                 ```-`.
             -.-/++.:sdo+.-+:
    `.--::. `s.dh:.++:/MM/`oMms-`
     /`/dhyoydh-dMs .s/oMM/ oMM-/y`
     `s.sMMN-.hd+sh- +:+NMd -MMh.Md:-
       ///+so .+:+:-/.:om:mo:mMy.MMNd
         `-:/:o+/-:`dy. yNym`/MNyMMMM.+`
          :/ss.--:/ `dN:.Mdyh sMMmNMd/m:
         +-od`./ho `.-Md MMhM. yMN-d/yM+
        -N/s+-md.   `+M:oMMMM:  dMo/mNM+
        yydh:NM-   o.sd:N/MMM.  +Ms:sMd:`
       `s-ymsMN     `ddoy mMs   +M:o:msy`
       ://-MsMs  ./+`/M+d dMh   dd`m`dMm
       +:/:dod:yhohN+-Mhd-mMm  oM++s hMy
       s:`ysdsMo.mMMohMhN:NMh /MM-/``NM-
      .s.:+moM+.mMMh/mhsm:Md./MMM-  oMy
      +`.-m:m+-ms+h.hs/sNh:`sMMMM- -MN.
     : ``o.y:/d--N.y/mhy: /mMMMMN `mM/
   ``    `:.o/  .hsy+-`-omh/+MMN:`dM+
  +-  .-   -.` ./`+oydMNs.`/NMh.`dM+
 .h: /sN   .--./  hhs+:/ohNms- :mN:
  `-. .`    o+o. :o-odNds/.  .yMy`
    + ``   +mm:o /h+:.     :yMd-
    `::://syy+.s  o`  `:+hNNs-
          .::::    -/shhs+-

ZEBRA v]] .. Zebra.version .. [[, a JSON-API web framework.

Usage: zebra COMMAND [ARGS]

The available zebra commands are:
 new [name]             Create a new Zebra application
 start                  Starts the Zebra server
 stop                   Stops the Zebra server
 generate migration     Create a new SQL migration
 migrate                Run all SQL migrations that have not been run
 migrate rollback       Rollback one SQL migration
 console                Start a Zebra console
]]

local launcher = require 'zebra.cli.launcher'
local application = require 'zebra.cli.application'
local migrations = require 'zebra.cli.migrations'
local console = require 'zebra.cli.console'

if arg[1] == 'new' and arg[2] then application.new(arg[2])
elseif arg[1] == 'start' then launcher.start()
elseif arg[1] == 'stop' then launcher.stop()
elseif arg[1] == 'generate' and arg[2] == 'migration' then migrations.new()
elseif arg[1] == 'migrate' and arg[2] == nil then migrations.up()
elseif arg[1] == 'migrate' and arg[2] == "rollback" then migrations.down()
elseif arg[1] == 'console' then console.start()
else print(help_description)
end
