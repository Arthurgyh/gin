#!/usr/bin/env lua

require 'carb.core.carb'

local help_description = "CARB v" .. Carb.version ..", a JSON-API web framework. " .. [[
Usage: carb COMMAND [ARGS]

The available carb commands are:
 new [name]             Create a new Carb application
 start                  Starts the Carb server
 stop                   Stops the Carb server
 generate migration     Create a new SQL migration
 migrate                Run all SQL migrations that have not been run
 migrate rollback       Rollback one SQL migration
]]

local launcher = require 'carb.cli.launcher'
local application = require 'carb.cli.application'
local sql_migrations = require 'carb.cli.sql_migrations'

if arg[1] == 'new' and arg[2] then application.new(arg[2])
elseif arg[1] == 'start' then launcher.start()
elseif arg[1] == 'stop' then launcher.stop()
elseif arg[1] == 'generate' and arg[2] == 'migration' then sql_migrations.new()
elseif arg[1] == 'migrate' and arg[2] == nil then sql_migrations.migrate()
elseif arg[1] == 'migrate' and arg[2] == "rollback" then sql_migrations.rollback()
else print(help_description)
end
